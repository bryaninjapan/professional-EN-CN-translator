# EN Translator 激活码系统使用说明

## 概述

这是一个基于 localStorage 的激活码系统（MVP版本），用于管理 EN Translator 的使用权限。激活码格式为 `ENTL-XXXX-XXXX-XXXX`，每个激活码提供 100 次翻译使用。

## 功能特性

### 1. 激活码格式
- 格式：`ENTL-XXXX-XXXX-XXXX`（4组4位字符）
- 示例：`ENTL-A3B9-C7D2-E1F4`
- 字符集：大写字母A-Z + 数字0-9（排除易混淆的O/0, I/1）

### 2. 管理员功能

访问地址：`/admin-license`

**功能：**
- 生成新激活码：点击"生成激活码"按钮，自动创建并复制到剪贴板
- 查看激活码列表：显示所有激活码及其状态
- 激活码信息：
  - 激活码代码
  - 生成时间
  - 状态（未激活/已激活/已用完）
  - 使用情况（已用次数/总次数）
  - 激活时间
  - 操作（复制、删除）

**状态说明：**
- **未激活 (unused)**：激活码已生成但尚未被用户使用
- **已激活 (active)**：激活码已被用户激活，正在使用中
- **已用完 (depleted)**：激活码的100次使用次数已全部用完

### 3. 用户激活功能

**UI位置：**
- 在主页面右上角点击"激活码"按钮
- 弹出激活码输入模态框

**激活流程：**
1. 输入激活码（格式：ENTL-XXXX-XXXX-XXXX）
2. 点击"激活"按钮
3. 系统验证激活码：
   - 检查格式是否正确
   - 检查激活码是否存在
   - 检查激活码是否已被使用
4. 激活成功后：
   - 显示激活码和剩余次数
   - 初始化使用次数为100次
   - 保存到 localStorage

### 4. 翻译使用计数

- 每次成功翻译后，剩余次数自动 -1
- 在页面右上角显示"剩余次数：X / 100"
- 当次数为0时：
  - 翻译按钮自动禁用
  - 显示提示："使用次数已用完，请购买新的激活码"
  - 点击"激活码"按钮可重新激活

### 5. 数据存储

**管理员端数据：**
```javascript
localStorage['en_translator_license_codes'] = {
  "ENTL-XXXX-XXXX-XXXX": {
    "code": "ENTL-XXXX-XXXX-XXXX",
    "created_at": "2024-12-18T10:00:00Z",
    "status": "active", // unused/active/depleted
    "total_credits": 100,
    "credits_used": 0,
    "activated_at": "2024-12-18T10:05:00Z"
  }
}
```

**用户端数据：**
```javascript
localStorage['en_translator_user_license'] = {
  "license_key": "ENTL-XXXX-XXXX-XXXX",
  "credits_remaining": 95,
  "activated_at": "2024-12-18T10:05:00Z"
}
```

## 使用流程

### 管理员生成激活码

1. 访问 `/admin-license` 页面
2. 点击"生成激活码"按钮
3. 激活码自动生成并复制到剪贴板
4. 将激活码提供给用户（通过 Gumroad 等销售平台）

### 用户激活和使用

1. 用户购买激活码后，访问主页面
2. 点击右上角"激活码"按钮
3. 输入激活码并点击"激活"
4. 激活成功后开始使用翻译功能
5. 每次翻译消耗1次使用次数
6. 次数用完后需要购买新激活码

## 多语言支持

系统支持以下语言：
- 简体中文 (zh)
- 日本語 (ja)
- 한국어 (ko)

所有激活码相关的文案都已本地化。

## 技术实现

### 文件结构

```
en-translator/
├── lib/
│   └── license.ts          # 激活码工具函数
├── app/
│   ├── admin-license/
│   │   └── page.tsx        # 管理员页面
│   └── page.tsx            # 主页面（已集成激活功能）
```

### 核心函数

**管理员端：**
- `generateLicenseCode()` - 生成激活码
- `createLicenseCode()` - 创建并保存激活码
- `getAllLicenseCodes()` - 获取所有激活码
- `deleteLicenseCode()` - 删除激活码

**用户端：**
- `activateLicense()` - 激活激活码
- `getUserLicense()` - 获取用户激活信息
- `consumeCredit()` - 消耗一次使用次数
- `restoreCredit()` - 恢复一次使用次数（翻译失败时）
- `getRemainingCredits()` - 获取剩余次数

## 安全说明

⚠️ **MVP版本限制：**
- 数据存储在浏览器 localStorage，可被用户修改
- 这是可接受的 MVP 风险，用于快速测试市场
- 未来可升级为服务器端验证（Cloudflare Workers + KV/D1）

## 测试场景

1. ✅ 管理员生成激活码并复制
2. ✅ 用户输入激活码激活成功
3. ✅ 用户进行翻译，次数正常递减
4. ✅ 用户用完100次后无法继续使用
5. ✅ 用户尝试使用已激活的激活码（应该失败）
6. ✅ 用户尝试使用不存在的激活码（应该失败）
7. ✅ 翻译失败时自动恢复使用次数

## 未来改进

- [ ] 服务器端验证（Cloudflare Workers）
- [ ] 邮件自动发送激活码
- [ ] 激活码批量导入/导出
- [ ] 使用统计和分析
- [ ] 激活码过期时间管理

## 注意事项

1. 激活码数据存储在浏览器本地，清除浏览器数据会丢失
2. 同一激活码可以在不同设备上激活（当前版本）
3. 管理员和用户的数据是分离的，但共享激活码数据库
4. 建议定期备份激活码数据（导出 localStorage）

